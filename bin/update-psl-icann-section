#!/usr/bin/env php
<?php

use League\Uri\PublicSuffix\Cache;
use League\Uri\PublicSuffix\CurlHttpClient;
use League\Uri\PublicSuffix\ICANNSectionManager;

function getVendorPath()
{
    if (is_dir($vendor = __DIR__.'/../vendor')) {
        return $vendor;
    }

    if (is_dir($vendor = __DIR__.'/../../../../vendor')) {
        return $vendor;
    }

    return null;
}

if (!extension_loaded('curl')) {
    echo 'To work as intended this script requires the PHP cURL extension'.PHP_EOL;
    die(1);
}

if (null === ($vendorPath = getVendorPath())) {
    echo 'You must set up the project dependencies using composer see https://getcomposer.org'.PHP_EOL;
    die(1);
}

require $vendorPath.'/autoload.php';

try {
    echo 'Updating Public Suffix List ICANN Section.' . PHP_EOL;
    $manager = new ICANNSectionManager(new Cache(), new CurlHttpClient());
    $manager->refreshRules();
    echo 'Update complete.' . PHP_EOL;
    die(0);
} catch (Throwable $e) {
    echo 'An error occurred while updating the Public Suffix List ICANN Section.' . PHP_EOL;
    echo $e->getMessage() . PHP_EOL;
    die(1);
}